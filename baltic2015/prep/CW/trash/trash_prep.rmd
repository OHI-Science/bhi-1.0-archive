---
title: "Trash Exploration (Jambeck et al 2015)"
output: html_document
---

Proposed data for trash from [**Jambeck et al 2015: Plastic waste inputs from land into the ocean**](http://science.sciencemag.org/content/347/6223/768.full.pdf+html)

*"the framework includes: 

    - (i) the mass of waste generated per capita annually; 
    - (ii) the percentage of waste that is plastic; and 
    - (iii) the percentage of plastic waste that is mismanaged and, therefore, has the potential to enter the ocean as marine debris (12) (data S1). By applying a range of conversion rates from mismanaged waste to marine debris, we estimated the mass of plastic waste entering the ocean from each country in 2010, used population growth data (13) to project the increase in mass to 2025, and predicted growth in the percentage of waste that is plastic."*

## Potential path forward:

**Status**: 2010 modeled values / ref point  
**Ref pt**: need to explore literature/mgt: some % decrease from 2010...  
**Trend**: use projected 2025 data to get 5-year trend

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}

## packages, directories
library(dplyr)
library(readr)  # install.packages('readr')
library(readxl) # install.packages('readxl')
library(ggplot2)
library(stringr)

dir_prep   = '~/github/bhi/baltic2015/prep'
dir_raw    = file.path(dir_prep, 'CW/trash/raw')
trash_file = '1260352_SupportingFile_Suppl._Excel_seq1_v1.xlsx'

## lookup table
baltic_lookup = read_csv(file.path(dir_prep, 'country_id.csv'))

```

## Modeled Mismanaged plastic waste 2010 
Note: these data are for all of these countries, so do fraction of coastline or something to downweight
```{r data explore, echo = FALSE, message = FALSE, warning = FALSE}
## read in data
data_raw = read_excel(file.path(dir_raw, trash_file));  #head(data_raw); summary(data_raw)

## filter and rename
data_clean = data_raw %>%
  dplyr::rename(
    country                      = Country,
    econ_status                  = `Economic status1`,
    coastal_pop                  = `Coastal population2`,
    waste_gen_rate_kg_person_day = `Waste generation rate [kg/person/day]3`,
    perc_plastic_waste_stream    = `% Plastic in waste stream4`,
    perc_inadq_managed_waste     = `% Inadequately managed waste5`,
    perc_littered_waste          = `% Littered waste6`,
    waste_gen_kg_day             = `Waste generation [kg/day]7`,
    plastic_waste_gen_kg_day     = `Plastic waste generation [kg/day]7`,
    inadq_managed_plastic_kg_day = `Inadequately managed plastic waste [kg/day]7`,
    plastic_waste_littered       = `Plastic waste littered\r\n [kg/day]7`,
    modeled_waste_percap         = `Mismanaged plastic waste [kg/person/day]7`,
    modeled_waste_2010           = `Mismanaged plastic waste in 2010\r\n [tonnes]7`,
    modeled_waste_2025           = `Mismanaged plastic waste in 2025\r\n [tonnes]7`) %>%
  mutate(country = str_replace_all(country, '8', ''))

baltic = data_clean %>%
  filter(country %in% baltic_lookup$country_name)


## save data (columnnames cleaned and data filtered for BHI)

write.csv(baltic, '~/github/bhi/baltic2015/prep/CW/trash/intermediate/trash_jambeck_baltic.csv')

## plot 2010
ggplot(baltic, aes(country, modeled_waste_2010)) +
  geom_bar(stat='identity')

```


## Modeled Mismanaged plastic waste 2025
Note: these data are for all of these countries, so do fraction of coastline or something to downweight

```{r data explore 2025, echo = FALSE, message = FALSE, warning = FALSE}

## plot 2025
ggplot(baltic, aes(country, modeled_waste_2025)) +
  geom_bar(stat='identity')

```


## Prepare data layer for Toolbox 

**Plan:** 

Modeled Mismanaged plastic waste data (tonnes) are reported for each country. We will create scores for each country related to the reference point, and then apply to all of that country's BHI regions under the assumption that the management for the country is probably equal.  Note: for BHI 2.0, would be better to recalcuate their model using coastal population for each BHI region. 

**Reference points**

Need a min and a max reference point (they will ultimately be inverted for CW but not as a pressure)

- **Minimum modeled trash entering the ocean = 0** (we want no trash entering the ocean)
- **Maximum modeled trash entering the ocean = highest Eurpean country in 2025** (we have 2025 modeled data. Is this reasonable, ie do we think that the maximum trash we see in Europe, or is that too high because it's based on a larger population that we don't have now? Another option would be to make a linear model between 2010 and 2025 and choose a year more like 2015?)

Note: Because Russia is reported as a whole country, we used the proportion of population in Kaliningrad+St Petersburg to the coastal popultion reported by Jambeck et al. See figure below. 


```{r data layer, echo = FALSE, message = FALSE, warning = FALSE}

## havea another look at the data
# baltic = read.csv('~/github/bhi/baltic2015/prep/CW/trash/intermediate/trash_jambeck_baltic.csv')
summary(baltic) 
summary(data_clean)


## select desired columns
data_clean_select = data_clean %>%
  select(country, coastal_pop, modeled_waste_2010, modeled_waste_2025)

## read in lookup table for European countries
lookup = read.csv('~/github/bhi/baltic2015/prep/EUcountrynames.csv', sep=';') %>%
  mutate(country_abb = as.character(country_abb),
         country     = as.character(country)); head(lookup)

## join lookup table to trash data; remove inland NAs and Kosovo, Macedonia, Serbia (no trash data)
europe = lookup %>%
  left_join(data_clean_select, by = 'country') %>%
  filter(!is.na(coastal_pop)) %>%
  select(-country_abb); head(europe)

## downweight russia **very hacky for now**
#  4597600 # St Petersbergy: from Wikipedia https://en.wikipedia.org/wiki/Demographics_of_Saint_Petersburg
#  431902  # Kaliningrad https://en.wikipedia.org/wiki/Kaliningrad
rus_trash_pop = data_clean_select %>%
  filter(country == 'Russia') %>%
  select(coastal_pop)

rus_coastal_pop_proportion = as.numeric((4597600+431902) / rus_trash_pop); rus_coastal_pop_proportion

rus = data_clean_select %>%
  filter(country == 'Russia') %>%
  mutate(modeled_waste_2010 = modeled_waste_2010 * rus_coastal_pop_proportion, 
         modeled_waste_2025 = modeled_waste_2025 * rus_coastal_pop_proportion); rus
  
## consider also downweighting Germany, Denmark, Sweden?


## create dataframe of europe + russia
eur_rus = rbind(
  europe,
  rus) %>%
  arrange(desc(modeled_waste_2010)); eur_rus # view high to low 

#          country coastal_pop modeled_waste_2010 modeled_waste_2025
# 1  United Kingdom    43258889         67549.0366          94164.763
# 2           Spain    22771488         45852.5667          58932.137
# 3          Russia    10812537         37565.6491          59979.992
# 4           Italy    33822532         32760.5217          45057.641
# 5         Germany     8837035         31238.8171          33317.160
# 6         Albania     2530533         29705.3126          63050.750
# 7     Netherlands     8971770         27699.9990          32387.322
# 8          France    17287280         24108.7024          34670.991
# 9        Bulgaria     1002695         18739.1874          25769.975
# 10        Croatia     1602782         16460.5644          19593.329
# 11       Portugal     8507951         16402.4258          19381.611
# 12         Poland     3272933         15703.3319          26855.403
# 13         Greece     9794702         14228.7643          18621.055
# 14        Ireland     3749576         11709.9746          14044.832
# 15         Latvia     1432078         10284.3426          16653.878
# 16         Norway     4131679          8402.9261           9798.186
# 17        Estonia      878021          5978.8656           8367.121
# 18        Finland     2927674          4984.7031           6421.851
# 19     Montenegro      260336          4416.3229           7243.970
# 20        Romania      875170          3610.3512           8261.077
# 21      Lithuania      443894          3478.6548           5477.922
# 22        Belgium     4747957          2742.8259           5738.855
# 23          Malta      404707          2619.7926           3756.623
# 24         Sweden     6202234          2150.3983           5245.349
# 25         Cyprus      840556          1821.3253           2610.825
# 26        Denmark     5376386          1790.8688           4232.910
# 27        Iceland      292708           598.3379            883.448
# 28       Slovenia      336594           556.0515            984.811


## set min and max reference points ----
## rescale to reference point -- whole European

ref_point_min = 0

##2010
ref_point_max_2010 = eur_rus %>%
  filter(modeled_waste_2010 == max(modeled_waste_2010)); print(ref_point_max_2010)
ref_point_max_2010 = ref_point_max_2010$modeled_waste_2010

## 2025
ref_point_max_2025 = eur_rus %>%
  filter(modeled_waste_2025 == max(modeled_waste_2025)); print(ref_point_max_2025)
ref_point_max_2025 = ref_point_max_2025$modeled_waste_2025


## calculate ref point
## to normalize data: normalized = (x-min(x))/(max(x)-min(x))
baltic_layer = eur_rus %>%
  filter(country %in% baltic$country) %>%
  mutate(
    trash_score_2010   = (
      (modeled_waste_2010 - ref_point_min) /
      (ref_point_max_2010 - ref_point_min)),
    trash_score_2025   = (
      (modeled_waste_2025 - ref_point_min) /
      (ref_point_max_2025 - ref_point_min))); baltic_layer; summary(baltic_layer)

#compare reference points - makes minimal differences in scores, country order does not change.  Larger differences for Germany & Russia (lesser degree Poland)
ggplot(baltic_layer)+
  geom_point(aes(country,trash_score_2010, colour="red"))+
  geom_point(aes(country,trash_score_2025))+
  ggtitle('Country Trash Score')





  

## calculate trend; maybe make a linear model between 2010 and 2025, take trend as 5 years out?

## assign to BHI regions
  


```


It made sense to downweight Kaliningrad and St Petersburg by coastal population density instead of total Russia population density because of the distribution along the coasts:
[figure of Russia coastal population density](./baltic2015/prep/CW/trash/RussiaCoastalPopFig_Wikipedia.jpg)

