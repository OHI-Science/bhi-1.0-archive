---
title: "eco_prep.rmd"
output:
  github_document:
    toc: true
    toc_depth: 3
params: 
    datasource: csv
---

# ECO subgoal data preparation

```{r setup}

## Libraries
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(RMySQL)
library(stringr)
library(tools)
library(rprojroot) # install.packages('rprojroot')

source('~/github/bhi/baltic2015/prep/common.r')


## rprojroot
root <- rprojroot::is_rstudio_project


## make_path() function to 
make_path <- function(...) rprojroot::find_root_file(..., criterion = is_rstudio_project)

dir_layers = make_path('baltic2015/layers') # replaces  file.path(dir_baltic, 'layers')


# root$find_file("README.md")
# 
# root$find_file("ao_need_gl2014.csv")
# 
# root <- find_root_file("install_ohicore.r", 
# 
# withr::with_dir(
#   root_file("DESCRIPTION"))



dir_eco    = file.path(dir_prep, 'ECO')

## add a README.md to the prep directory with the rawgit.com url for viewing on GitHub
create_readme(dir_eco, 'eco_prep.rmd')

```

## 1. Background

## 2. Data

### 2.1 Regional Data
Eurostat regional (NUTS3) GDP
Data downloaded on 12 May 2016 from Eurostat database [nama_10r_3gdp](http://ec.europa.eu/eurostat/data/database?p_auth=EgN81qAf&p_p_id=estatsearchportlet_WAR_estatsearchportlet&p_p_lifecycle=1&p_p_state=maximized&p_p_mode=view&_estatsearchportlet_WAR_estatsearchportlet_action=search&text=nama_10r_3gdp)  

Nominal GDP data in millions of Euros.

No data for Russia regions.  

### 2.2 Country Level data
Eurostat Country GDP data
Data downloaded 22 March 2016 from Eurostat Database [nama_10_gdp](http://ec.europa.eu/eurostat/data/database?p_auth=sHLAepWT&p_p_id=estatsearchportlet_WAR_estatsearchportlet&p_p_lifecycle=1&p_p_state=maximized&p_p_mode=view&_estatsearchportlet_WAR_estatsearchportlet_action=search&text=nama_10_gdp)  

Nominal GDP in millions of Euros.  

Data does not include Russia

### 2.3 Russian country level data

Eurostat database [naida_10_gdp](http://ec.europa.eu/eurostat/web/products-datasets/-/naida_10_gdp)  

[Metadata link](http://ec.europa.eu/eurostat/cache/metadata/en/naid_10_esms.htm)  

Download criteria:  
Russia; Gross domestic product at market prices; CP_MEUR (Current prices, million euro ); 2000-2014


### 2.4 Population density data

#### 2.4.1 Fine scale
Population density data obtained from the [HYDE database](http://themasites.pbl.nl/tridion/en/themasites/hyde/download/index-2.html)

Year of data = 2005. Data were a 5' resolution. Erik Smedberg with the Baltic Sea Center re-gridded to a 10 x 10 km grid.

Population density within a 25km buffer from the coast will be used.

References:
Klein Goldewijk, K. , A. Beusen, M. de Vos and G. van Drecht (2011). The HYDE 3.1 spatially explicit database of human induced land use change over the past 12,000 years, Global Ecology and Biogeography20(1): 73-86. DOI: 10.1111/j.1466-8238.2010.00587.x.

Klein Goldewijk, K. , A. Beusen, and P. Janssen (2010). Long term dynamic modeling of global population and built-up area in a spatially explicit way, HYDE 3 .1. The Holocene20(4):565-573. http://dx.doi.org/10.1177/0959683609356587

#### 2.4.2 National
**EU countries**  
Downloaded on March 31 2016 from Eurostat database [demo_gind](http://ec.europa.eu/eurostat/data/database?p_auth=whAQQAX7&p_p_id=estatsearchportlet_WAR_estatsearchportlet&p_p_lifecycle=1&p_p_state=maximized&p_p_mode=view&_estatsearchportlet_WAR_estatsearchportlet_action=search&text=demo_gind)  

Variables:  
1990-2015 
Population on Jan1  

[Metadata Link](http://ec.europa.eu/eurostat/cache/metadata/en/demo_gind_esms.htm)  

*Population on 1 January:*  
Eurostat aims at collecting from the EU-28's Member States' data on population on 31st December, which is further published as 1 January of the following year. The recommended definition is the 'usual resident population' and represents the number of inhabitants of a given area on 31st December . However, the population transmitted by the countries can also be either based on data from the most recent census adjusted by the components of population change produced since the last census, either based on population registers.


**Russia**  
Downloaded on 10 June 2016 from Eurostat database:   [naida_10_pe](http://ec.europa.eu/eurostat/web/products-datasets/-/naida_10_pe)  
population (thousands of people)  
employment (thousands of people) *need to exclude this*  
 

### 2.5 Aligning BHI regions with NUTS3 regions and population density
NEED TO ADD LINK to MARC methods  
 
NUTS3 GDP data is joined in the database to the area and population density information associated with that NUTS3 and BHI region.

#### 2.5.1 Guide to column names in regional GDP associated with population density and area:  
PopTot = total population in the BHI region's 25km buffer overlapping with a NUTS3 region  
PopUrb = urban population in the BHI region's 25km buffer overlapping with a NUTS3 region  
PopRur = rural population in the BHI region's 25km buffer overlapping with a NUTS3 region  
PopTot_density_in_buffer_per_km2" = total population in the BHI region's 25km buffer overlapping with a NUTS3 region  population in the BHI region's 25km buffer overlapping with a NUTS3 region divided by the area within that buffer and NUTS3 region  
PopUrb_density_in_buffer_per_km2 = urban population in the BHI region's 25km buffer overlapping with a NUTS3 region  population in the BHI region's 25km buffer overlapping with a NUTS3 region divided by the area within that buffer and NUTS3 region  
PopRur_density_in_buffer_per_km2 = rural population in the BHI region's 25km buffer overlapping with a NUTS3 region  population in the BHI region's 25km buffer overlapping with a NUTS3 region divided by the area within that buffer and NUTS3 region  
NUTS3_area_in_BHI_buffer_km2 = area of a NUTS3 region associated with the 25km buffer of a BHI region  



## 3. Goal Model

'Xeco = (GDP_Region_c/GDP_Region_r)/(GDP_Country_c/GDP_Country_r)  
'c = current year, r=reference year  '
'reference point is a moving window (single year value)
'Region is the BHI region which is comprised of GDP data from the associated NUTS3 regions
'data can be in nominal GDP because is a ratio value (adjusting by a deflator would cancel out)  
'each BHI region is composed by one or more NUTS3 regions, these are allocated by population density from each NUTS3 region associated with a given BHI region




## 4. Other
NEED TO UPDATE - this may change
### 4.1 Interpreting NA and zero
#### 4.1.1 Status Score of Zero
'Status scores of zero were assigned when the region had no data or insufficient data but the indicator is applicable

#### 4.1.2 Trend value of NA
'Trend values of NA are assigned if there are not 5 years of data available to calculate a trend




## 5. Regional GDP prep

### 5.1 Data organization

#### 5.1.1 Read in data
This should be check and updated when data are updated in database. Data should be extract from database by ´eco_prep_database_call.r´ and saved to folder ´eco_data_database´

```{r read in regional gdp}
regional_gdp = read.csv(file.path(dir_eco, 'eco_data_database/nuts3_gdp.csv'))

dim(regional_gdp) #21375    18

str(regional_gdp)
```

#### 5.1.2 clean data object
```{r clean regional gdp object}
unique(regional_gdp$UNIT) ## Million euro 

regional_gdp = regional_gdp %>%
               select(-PopUrb,-PopRur,-PopUrb_density_in_buffer_per_km2,-PopRur_density_in_buffer_per_km2,-HELCOM_ID)%>% ## remove data not needed
              dplyr::rename(year = TIME, nuts3 = GEO, nuts3_name = GEO_LABEL,
                            unit = UNIT, value = Value, flag_notes = Flag_and_Footnotes,
                            rgn_id = BHI_ID,pop = PopTot,pop_km2 = PopTot_density_in_buffer_per_km2,
                            country_abb = CNTR_CODE,country=rgn_nam, basin= Subbasin,
                            area_nuts3_in_bhi_buffer= NUTS3_area_in_BHI_buffer_km2)%>%
              mutate(nuts3 = as.character(nuts3), 
                     nuts3_name = as.character(nuts3_name),
                     unit = as.character(unit),
                     country_abb=as.character(country_abb),
                     country = as.character(country),
                     basin = as.character(basin))

str(regional_gdp)



```

#### 5.1.3 Find NUTS3 regions assigned to incorrect BHI region
Due to small differences in the shapefiles, some NUTS3 regions assigned to a BHI region belonging to a different country.  
```{r}
## find mis-assigned NUTS and BHI regions
mis_assigned =regional_gdp %>% 
  filter(grepl("Denmark|Estonia|Finland|Germany|Latvia|Lithuania|Poland|Sweden|Russia",country)) %>% ## include Russia because some mis-assigned
select(country,country_abb, rgn_id,nuts3) %>% distinct() %>% arrange(rgn_id,country) %>%
  dplyr::rename(BHI_ID = rgn_id,
                country_bhi = country,
                country_abb_nuts = country_abb)
#write to csv
#write.csv(mis_assigned, file.path(dir_eco,"mis_assigned_bhi_nuts3.csv"),row.names = FALSE)
```

#### 5.1.4 Manually fix NUTS3 regions assigned to incorrect BHI region
```{r fix mis-assigned NUTS3 regions}
## upload corrected files - the file exported in 5.1.3 was reviewed and corrected manually
correct_assign = read.csv(file.path(dir_eco,"mis_assigned_bhi_nuts3_corrected_manually.csv"),sep=";", stringsAsFactors = FALSE)
str(correct_assign)

regional_gdp1 = full_join(regional_gdp,correct_assign,
                          by=c("country"="country_bhi", "country_abb"="country_abb_nuts",
                               "rgn_id"="BHI_ID", "nuts3"))

## replace the country and rgn_id with the "corrected column"
regional_gdp1 = regional_gdp1 %>%
                select(-country,-rgn_id,-MISASSIGNED,-BHI_ID_manual,-country_manual)%>%
                dplyr::rename(rgn_id = correct_BHI_ID,
                              country= correct_country) %>%
                arrange(nuts3)

```

#### 5.1.5 check NA in final years
```{r check NA in 2014}
##check 2014 - is max year?
regional_gdp1 %>% 
  select(country_abb,year,value)%>%
  group_by(country_abb)%>%
  summarise(max_year = max(year))%>%
  ungroup()%>%
  left_join(.,select(regional_gdp1, country_abb,year,value,nuts3,rgn_id),
            by=c("country_abb","max_year"="year"))%>%
  filter(!is.na(rgn_id))%>%
  print(n=100)%>%
  filter(!is.na(value))%>%
  select(country_abb)%>%
  distinct()

## only Estonia and Denmark provide 2014 data

## check 2013
regional_gdp1 %>% 
  select(country_abb,year,value,rgn_id,nuts3)%>%
  filter(year == 2013) %>%
  filter(!is.na(rgn_id))%>%
  filter(!is.na(value))%>%
  select(country_abb)%>%
  distinct()
## all countries have 2013 data

```


### 5.2 Data associations with Baltic and BHI
#### 5.2.1 Filter for Baltic countries
Only NUTS3 regions associated with a BHI ID have a country name, so this effectively selects the NUTS3 regions on the Baltic Coast  
```{r filter for baltic countries}
## read in EU country abbreviations and names
##eu_lookup = read.csv(file.path(dir_eco, 'EUcountrynames.csv'), sep=";")  

## add country names to regional_gdp and filter for Baltic countries
regional_gdp2 = regional_gdp1 %>%
               filter(grepl("Denmark|Estonia|Finland|Germany|Latvia|Lithuania|Poland|Sweden",country))
               
str(regional_gdp2)
unique(regional_gdp2$country)
unique(regional_gdp2$country_abb)


```

#### 5.2.2 Remove 2014
Only 2 countries have data
```{r remove 2014 from regional data}
regional_gdp2 = regional_gdp2 %>%
                filter(year < 2014)

```


#### 5.2.2 Plot regional GDP, divide by country
Check to make sure each BHI region is only associated with NUTS regions from a single country
```{r plot regional gdp raw}
ggplot(regional_gdp2) +
  geom_point(aes(year, value, col=nuts3))+
  facet_wrap(~country)+
  ylab("GDP (million euro)")+
  #guides(color="none")+
  ggtitle("regional GDP by countries")


ggplot(regional_gdp2) +
  geom_point(aes(year, value, col=country),size=.7)+
  facet_wrap(~rgn_id, scales="free_y")+
  ylab("GDP (million euro)")+
  ggtitle("NUTS3 GDP by BHI region")


```

#### 5.2.3 Check data flags
```{r check regional data data flags}
regional_gdp2 %>% filter(!is.na(flag_notes))
## no data flags

regional_gdp2 = regional_gdp2 %>%
                select(-flag_notes)

```


### 5.3 BHI region GDP
Each regional GDP is divided among BHI regions proportional to the population of the NUTS3 region associated with the BHI region.  

Currently the population of the entire NUTS3 region is not extracted so the total GDP of the NUTS3 region is divided among the BHI regions, rather than dividing the fraction of the NUTS3 GDP associated with the NUTS3 25km coastal population.  

#### 5.3.1 NUTS3 - BHI region lookup
```{r nuts3 and bhi region lookup}
nuts3_bhi_lookup = regional_gdp2 %>%
                   select(rgn_id,nuts3)%>%
                   distinct()

```


#### 5.3.2 Identify total NUTS3 population in the 25km buffer
Sum across BHI regions associated with a NUTS3. This is the same for all years as population data comes from a single year.  

```{r NUTS3 population in the buff }

nuts3_buffer_pop= regional_gdp2 %>%
                  select(nuts3,pop,area_nuts3_in_bhi_buffer)%>%
                  distinct()%>% ## because duplicated for each year
                  group_by(nuts3)%>%
                  summarise(pop_nuts3 = sum(pop),
                            area_nuts3 = sum(area_nuts3_in_bhi_buffer))%>%
                  ungroup()


```


#### 5.3.3 Join the total NUTS3 area and population to the per BHI region
```{r join total nuts3 area and pop to bhi region data}
nuts3_bhi_join  = nuts3_buffer_pop %>%
                  full_join(., regional_gdp2, by="nuts3")


```


#### 5.3.4 Calculate the GDP fraction for BHI region based on the population fraction

```{r calculation GDP fraction based on population fraction}
nuts3_bhi_join2 = nuts3_bhi_join %>%
                  mutate(bhi_pop_prop = pop / pop_nuts3,
                         bhi_gdp_prop = value * bhi_pop_prop) %>%
                  arrange(rgn_id, year)


nuts3_bhi_join2 %>% select(nuts3, country,pop_nuts3, pop,bhi_pop_prop)%>%distinct()%>%arrange(nuts3)
  
```

#### 5.3.5 Plot the population fraction and GDP fraction from each NUTS3 associated with each BHI region
```{r plot pop and gdp fraction in each bhi}
ggplot(nuts3_bhi_join2)+
  geom_point(aes(rgn_id,bhi_pop_prop,colour=nuts3))+
  facet_wrap(~country)+
  ylim(0,1)+
  ggtitle("Population Fraction of NUTS3 regions for each BHI region")
  
ggplot(nuts3_bhi_join2)+
  geom_point(aes(year,bhi_gdp_prop,colour=nuts3),size=.8)+
  facet_wrap(~rgn_id, scales="free_y")+
  guides(colour="none")+
  ggtitle("NUTS3 GDP allocated to each BHI region based on population")
  

```

#### 5.3.6 Calculate the total BHI region buffer population and total BHI region GDP
```{r calculate bhi region pop and gdp}

bhi_gdp = nuts3_bhi_join2 %>%
          group_by(rgn_id,year)%>%
          summarise(bhi_pop = sum(pop),
                    bhi_gdp = sum(bhi_gdp_prop))%>%
          ungroup()%>%
          mutate(bhi_gdp_per_capita = bhi_gdp/bhi_pop)

str(bhi_gdp)

```

#### 5.3.7 Plot Total GDP per BHI region
```{r plot total gdp per BHI region}
ggplot(bhi_gdp)+
  geom_point(aes(year,bhi_gdp),size=1)+
  facet_wrap(~rgn_id, scales="free_y")+
  ylab("GDP (million euro)")+
  ggtitle("BHI region GDP")

```

#### 5.3.7 Plot GDP per capita (population in the 25km buffer) by BHI region
```{r plot per capita gdp per BHI region}
ggplot(bhi_gdp)+
  geom_point(aes(year,bhi_gdp_per_capita),size=1)+
  facet_wrap(~rgn_id, scales="free_y")+
  ylab("GDP per capita (million euro)")+
  theme(axis.text.x = element_text(colour="grey20", size=8, angle=90,
                                   hjust=.5, vjust=.5, face = "plain"),
        axis.text.y = element_text(size=6))+
  ggtitle("BHI region per capita GDP")

```

### 5.4 Data layer for layers
Will export per capita GDP. This value only changes because of changes in GDP size, the population size is static because only have data from 2005.  
### 5.4.1 Prepare object for csv
```{r prepare regional bhi gdp for layers}
bhi_gdp_layer = bhi_gdp %>%
                select(rgn_id,year,bhi_gdp_per_capita)


```
### 5.4.2

```{r write regional gdp bhi layer}
write.csv(bhi_gdp_layer, file.path(dir_layers, "le_gdp_region_bhi2015.csv"),row.names=FALSE)

```


## 6.Country GDP prep

### 6.1 Organize data

#### 6.1.1 Read in data

```{r read in country gdp}
## read EU national GDP
country_gdp = read.csv(file.path(dir_eco, 'eco_data_database/nuts0_gdp.csv'))
 dim(country_gdp) #[1] 4428    8
 str(country_gdp)
 
## read in Russian national GDP
russian_nat_gdp = read.csv(file.path(dir_eco, 'eco_data_database/ru_nat_gdp.csv'))

dim(russian_nat_gdp) #16 6
str(russian_nat_gdp)

```

#### 6.1.2 Clean data
```{r clean country gdp data}
country_gdp = country_gdp %>%
              dplyr::rename(year = TIME, country_abb = GEO, country= GEO_LABEL,
                            unit=UNIT, na_item = NA_ITEM, na_item_label = NA_ITEM_LABEL,
                            value = Value, flag_notes = Flag.and.Footnotes) %>%
              mutate(country_abb = as.character(country_abb),
                     country = as.character(country))%>%
              mutate(country = ifelse(country =="Germany (until 1990 former territory of the FRG)","Germany",country ))

russian_nat_gdp = russian_nat_gdp %>%
                  dplyr::rename(year = TIME, country= GEO,
                            unit=UNIT, na_item = NA_ITEM,
                            value = Value, flag_notes = Flag.and.Footnotes) %>%
                            mutate(country_abb = "RU")

  


```

#### 6.1.3 Restrict years to >= 2000
For EU country GDP
```{r years to greater than or equal to 2000}
country_gdp = country_gdp %>%
              filter(year >=2000) %>%
               filter(grepl("Denmark|Estonia|Finland|Germany|Latvia|Lithuania|Poland|Sweden",country))
              

```

#### 6.1.4 Select unit type - 'current prices, million euro
For EU country GDP
```{r select unit type}

##EU country GDP
unique(country_gdp$unit)
##[1] Current prices, million euro              Chain linked volumes (2010), million euro
##[3] Chain linked volumes, index 2010=100

country_gdp = country_gdp %>%
              mutate(unit = as.character(unit))%>%
              filter(unit == "Current prices, million euro")%>%
              mutate(unit = "million euro")

dim(country_gdp) #[1] 128   8

## Russia GDP, clean unit code
russian_nat_gdp = russian_nat_gdp %>%
                  mutate(unit = "million euro")

```

#### 6.1.5 assign data flag codes
```{r data flag codes}
country_gdp %>% select(flag_notes)%>%distinct() ## p e
country_gdp = country_gdp %>%
              mutate(flag_notes = ifelse(flag_notes == 'p', "provisional",
                                  ifelse(flag_notes == 'e', "estimated", "")))
country_gdp %>% filter(flag_notes == "provisional" | flag_notes == "estimated")  ## no baltic countries


russian_nat_gdp %>% select(flag_notes) %>% distinct() #e
russian_nat_gdp = russian_nat_gdp %>%
                  mutate(flag_notes = ifelse(flag_notes == 'e', "estimated", ""))
russian_nat_gdp %>% filter(flag_notes == "estimated")  ## two years estimated 2000, 2001




```

### 6.2 Baltic regions

#### 6.2.1 Filter for Baltic countries
```{r filter country gdp for Baltic countries}

country_gdp2 = country_gdp %>%
                filter(grepl("Denmark|Estonia|Finland|Germany|Latvia|Lithuania|Poland|Sweden",country))
dim(country_gdp2);dim(country_gdp)                

colnames(country_gdp2)
colnames(russian_nat_gdp)

```

#### 6.2.2 Bind rows EU Baltic countries and Russia data
```{r join eu and russia}

country_gdp3 = bind_rows(select(country_gdp2, year, country, country_abb, unit, value, flag_notes),
                    select(russian_nat_gdp, year, country, country_abb, unit, value, flag_notes))
str(country_gdp3)

```  

#### 6.2.3 Plot National GDP
```{r plot national GDP}
ggplot(country_gdp3)+
  geom_point(aes(year,value))+
  facet_wrap(~country, scales="free_y") +
  ggtitle("National Nominal GDP")

```

### 6.4 Per capita national gdp

#### 6.4.1 read in population data
These data are in the folder 'eco_data_database' but have not yet been taken from server into BHI database
```{r read in national population data}
eu_pop = read.csv(file.path(dir_eco, 'eco_data_database/demo_gind_1_Data_cleaned.csv'), sep=";", stringsAsFactors = FALSE)

str(eu_pop)
dim(eu_pop)

ru_pop = read.csv(file.path(dir_eco, 'eco_data_database/naida_10_pe_1_Data_cleaned.csv'), sep=";", stringsAsFactors = FALSE)

str(ru_pop)
dim(ru_pop)


```


#### 6.4.2 clean population data
EU population size information:  
Population on 1 January: Eurostat aims at collecting from the EU-28's Member States' data on population on 31st December, which is further published as 1 January of the following year. The recommended definition is the 'usual resident population' and represents the number of inhabitants of a given area on 31st December . However, the population transmitted by the countries can also be either based on data from the most recent census adjusted by the components of population change produced since the last census, either based on population registers.  
[Source](http://ec.europa.eu/eurostat/cache/metadata/en/demo_gind_esms.htm)  
```{r clean national population data}
## EU countries
eu_pop2 = eu_pop %>%
          select(-TIME_LABEL)%>%
          dplyr::rename(year = TIME,
                        country_abb = GEO,
                        country= GEO_LABEL,
                        unit = INDIC_DE,
                        value = Value,
                        flag_notes = Flag.and.Footnotes)%>%
          filter(unit == "Population on 1 January - total " )%>% # select this meauresure of population size
          mutate(value = ifelse(value== ":", NA, value),
                value= as.numeric(value))


## select only Baltic countries and data since 2000
eu_pop3 = eu_pop2 %>%
          mutate(country = ifelse(country =="Germany (until 1990 former territory of the FRG)","Germany",country),
                 country = ifelse(country =="Germany (including former GDR)","Germany",country),
                 country_abb = ifelse(country_abb == "DE_TOT","DE",country_abb))%>%
          filter(grepl("Denmark|Estonia|Finland|Germany|Latvia|Lithuania|Poland|Sweden",country)) %>%
          filter(year >=2000)

str(eu_pop3)           

## check data flags
eu_pop3 %>% select(flag_notes)%>%distinct()
eu_pop3 %>% filter(flag_notes == "b")  ## b = break in time series -- this should be fine

eu_pop3 = eu_pop3 %>%
          select(-flag_notes)

##-----------------------------------------------------------##
## russian data

ru_pop2 = ru_pop%>%
          dplyr::rename(year = TIME,
                        country_abb = GEO,
                        country= GEO_LABEL,
                        unit = NA_ITEM,
                        unit_type = UNIT_LABEL,
                        value = Value,
                        flag_notes = Flag.and.Footnotes)%>%
          filter(unit=="Total population national concept") %>% ## other unit is employment
          mutate(value = value *1000)%>% ## convert value to total people not in thousands unit
         select(-unit_type,-UNIT)%>%
        filter(year>=2000)

##check data flags
ru_pop2 %>% select(flag_notes)%>%distinct()
ru_pop2 %>% filter(flag_notes =="e") ## population estimated in 2012 and 2013

ru_pop2 = ru_pop2 %>%
          select(-flag_notes)
str(ru_pop2)
```

#### 6.4.3 Combine EU and Russian data
```{r combined national pop data}
nat_pop = bind_rows(eu_pop3, ru_pop2)

## add column for the 2005 value, should I use to be consistent with regional gdp
nat_pop_2005 = nat_pop %>%
               filter(year==2005) %>%
               dplyr::rename(pop_2005 = value)%>%
               select(country, pop_2005)

nat_pop = nat_pop %>%
          full_join(., nat_pop_2005, by="country")

```



#### 6.4.4 Plot national population over time
```{r plot national population}


ggplot(nat_pop)+
  geom_point(aes(year,value))+
  geom_hline(aes(yintercept = pop_2005))+
  facet_wrap(~country, scales="free_y")+
  ylab("Number of people")+
  ggtitle("National Population Size")

```

### 6.5 Per capita National GDP

####

### 6.3 Join BHI region id to countries


### 6.4 Create and export country GDP data layer
